#! /bin/sh /usr/share/dpatch/dpatch-run
## 056-CVE-2007-6203.dpatch
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Fix potential XSS vulnerability because of unescaped
## DP: HTTP method in 413 error message (CVE-2007-6203).

@DPATCH@
diff -urNad etch-apache2~/modules/http/http_protocol.c etch-apache2/modules/http/http_protocol.c
--- etch-apache2~/modules/http/http_protocol.c	2006-07-12 05:38:44.000000000 +0200
+++ etch-apache2/modules/http/http_protocol.c	2007-12-07 19:36:15.619518552 +0100
@@ -910,7 +910,8 @@
                            NULL));
     case HTTP_METHOD_NOT_ALLOWED:
         return(apr_pstrcat(p,
-                           "<p>The requested method ", r->method,
+                           "<p>The requested method ",
+			   ap_escape_html(r->pool, r->method),
                            " is not allowed for the URL ",
                            ap_escape_html(r->pool, r->uri),
                            ".</p>\n",
@@ -928,7 +929,7 @@
     case HTTP_LENGTH_REQUIRED:
         s1 = apr_pstrcat(p,
                          "<p>A request of the requested method ",
-                         r->method,
+                         ap_escape_html(r->pool, r->method),
                          " requires a valid Content-length.<br />\n",
                          NULL);
         return(add_optional_notes(r, s1, "error-notes", "</p>\n"));
@@ -975,7 +976,7 @@
                            "The requested resource<br />",
                            ap_escape_html(r->pool, r->uri), "<br />\n",
                            "does not allow request data with ",
-                           r->method,
+                           ap_escape_html(r->pool, r->method),
                            " requests, or the amount of data provided in\n"
                            "the request exceeds the capacity limit.\n",
                            NULL));
